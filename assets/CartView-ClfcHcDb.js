import{c as J,j as e,u as K,r as x,C as R,m as F,B,H as ee,w,l as X,o as te,v as T,I as se,n as ae,J as re,K as ne,M as ie,P as ce,f as oe,k as le,W as de,z as ue,Q as me}from"./index-CiotmRmG.js";import{s as pe,l as xe}from"./chunk-2GIFKCNQ-G0Cyyed3.js";import{O as he}from"./values-B_3JHIYH.js";import{s as fe}from"./tvs-BJd3oYTX.js";import{i as ge}from"./chunk-6MDMHKHV-B82Z00N1.js";import{P as be}from"./PriceLabel-m13_eUWq.js";import{P as ve}from"./Payments-BsLwuLg8.js";import{S as je}from"./SimCardDownloadOutlined-5G6tP-6T.js";import"./index-C3DU8Es7.js";import"./svgsFormas-2bUQIzJb.js";const Ne=J(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"})),H=[{id:"img",label:"",disabledSort:!0},{id:"label",label:"Nombre"},{id:"qtt",label:"Cantidad",isNumeric:!0,disabledSort:!0},{id:"price",label:"Precio",isNumeric:!0},{id:"subtotal",label:"Subtotal",isNumeric:!0,disabledSort:!0}],U={total:0,base:0,percentage:0},G=10;function Se({downloading:o=!1,following:h=!1}){const m=K(),l=m.cart.value,[g,d]=x.useState(!0),[i,S]=x.useState([]),[y,q]=x.useState("price-asc"),[r,f]=x.useState(G),[n,_]=x.useState({...U}),v=i.slice(0,r),[j,M]=x.useState(structuredClone(l)),I=async()=>{d(!0);let t=X.filter(a=>a.id in l);t=JSON.parse(JSON.stringify(t));const s=await te(t,m.db.value,"thumbnails");m.db.set(s),t.map(a=>a.priceData=T(a.priceData,h&&a.categorie[0]==="imanes",l[a.id])),S(t),d(!1)},k=(t,s)=>{var N;const a=s[t],c=typeof a=="string"?a:"-";switch(t){case"label":return e.jsxs("div",{children:[e.jsx("a",{href:"#buscar/"+s.id,title:"Ver producto",className:"max-xs:whitespace-normal hover:underline",children:s.label}),e.jsx("p",{className:"capitalize text-second text-neutral-400",children:s.categorie.join(" > ")})]});case"img":const D=m.db.value[s.id];let L=!1;if(D.haveSvg&&s.forma){const p=he[s.forma[0]];if(p&&p.icon&&(L=p.icon),s.forma[1]&&p.subs&&s.forma[1]in p.subs){const W=p.subs[s.forma[1]];W.icon&&(L=W.icon)}}return L?e.jsx(L,{className:"w-[50px] h-fit max-h-[50px] self-center"}):e.jsx(se,{alt:`Imagen de ${s.label}`,className:"object-contain w-[50px] min-w-[50px] max-h-[50px]",src:D.thumbnails&&D.thumbnails[0]});case"categorie":return e.jsx("span",{className:"capitalize",children:s.categorie.join(" > ")});case"qtt":const A=j[s.id];return e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(ge,{name:String(s.id),"aria-label":"Cantidad",type:"number",isInvalid:!1,size:"sm",className:"w-24",classNames:{inputWrapper:"border-b-2 border-custom1 bg-transparent rounded-none",input:"text-prima"},startContent:"x",endContent:((N=s==null?void 0:s.priceData)==null?void 0:N.salesUnit)||"u",min:0,value:A?String(A):"",onChange:p=>b(p,s.id),onBlur:p=>P(p,s.id),onKeyDown:p=>E(p,s.id)}),e.jsx(B,{size:"small",color:"error",variant:"outlined",className:`hover:bg-[--variant-containedBg] hover:text-white${o?" hidden":""}`,title:"Quitar del carrito",onClick:()=>O(s.id),sx:{minWidth:0,px:.5},children:e.jsx(Ne,{className:"h-5 w-fit"})})]});case"price":return e.jsx(be,{itemData:s});case"subtotal":const Y=s.priceData.usePrice,Z=s.priceData.prices[Y];return w(Number(Z)*l[s.id]);default:return c}},u=(t,s)=>{const a=i.find(c=>c.id===s);if(a){const c=Number(t.value),N=structuredClone(l);a.priceData=T(a.priceData,h&&a.categorie[0]==="imanes",c),m.cart.set({...N,[s]:c})}},b=(t,s)=>{const a=i.find(N=>N.id===s);let c=Number(t.target.value);a&&c>0&&c<1&&a.priceData.salesDecimal&&!a.priceData.salesDecimal.includes(c)&&(c=1),M({...l,[s]:c})},P=(t,s)=>{u(t.target,s)},E=(t,s)=>{if(t.key==="Enter"){const a=t.target;u(a,s)}},O=t=>{m.cart.add(t,0)},$=()=>{if(i.length>0){let t=structuredClone(U);i.forEach(s=>{const a=s.priceData.usePrice,c=s.priceData.prices[a],N=s.priceData.prices.base,D=l[s.id];t.total+=Number(c)*D,t.base+=N*D}),t.percentage=(t.base-t.total)/t.base,_(t)}},z=()=>{const t=r+G;f(t)},Q=t=>{var c;const s=((c=t.currentTarget.dataset)==null?void 0:c.column)||"price";let a="desc";y.includes("desc")&&(a="asc"),q(s+"-"+a)},V=()=>{if(y){const[t,s]=y.split("-"),a=i.sort(ae(t,s));S(a)}};return x.useEffect(()=>{I()},[l]),x.useEffect(()=>{$()},[i]),x.useEffect(V,[y]),x.useEffect(()=>{o&&f(i.length)},[o]),g?e.jsx(R,{className:"place-self-center m-6"}):Object.keys(l).length<1?e.jsx("b",{className:"text-center text-xl p-4",children:"Sin art칤culos para mostrar."}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-neutral-400 text-start ps-2 font-semibold self-center",children:["Total de art칤culos: ",i.length]}),e.jsx(F.section,{variants:{hidden:{},visible:{transition:{delayChildren:.1,staggerChildren:.1}}},initial:"hidden",animate:"visible",className:`w-full sm:px-4 ${fe}`,style:{overflowX:o?"visible":"auto",maxWidth:o?"none":"90vw",paddingBottom:o?"0":"0.5rem"},children:e.jsxs("table",{className:"w-full sm:min-w-[640px]",children:[e.jsx("thead",{className:"border-b-3",children:e.jsx("tr",{children:H.map(t=>e.jsxs("th",{className:`p-2 whitespace-nowrap${t!=null&&t.disabledSort?"":" cursor-pointer hover:opacity-80"}`,style:{textAlign:t!=null&&t.isNumeric?"end":"start"},"data-column":t.id,onClick:t!=null&&t.disabledSort?void 0:Q,children:[t.label,!(t!=null&&t.disabledSort)&&y.includes(t.id)?y.includes("desc")?" 游모":" 游몪":null]},t.id))})}),e.jsxs("tbody",{children:[v.map(t=>e.jsx(F.tr,{variants:{hidden:{opacity:0,x:100},visible:{opacity:1,x:0}},className:"even:text-custom2-10 dark:even:text-custom1 group hover:bg-secondary/30",children:H.map(s=>e.jsx("td",{className:"px-3 py-2 sm:px-1 group-hover:font-semibold whitespace-nowrap",style:{textAlign:s!=null&&s.isNumeric?"end":"start"},children:k(s.id,t)},s.id+"-"+t.id))},t.id)),e.jsxs("tr",{children:[e.jsx("td",{children:!(r<i.length)&&e.jsx(B,{variant:"contained",className:"bg-custom1-2 text-custom2 hover:scale-105",title:"Mostrar mas",onClick:()=>z(),sx:{textTransform:"none",borderRadius:3,fontFamily:"unset",fontWeight:"bold"},children:"Siguientes"})}),e.jsx("td",{colSpan:4})]})]})]})}),i.length>0&&e.jsxs("section",{className:"self-end font-semibold px-4 text-end border-3 border-customSwitch/80 rounded-md p-2",children:[(n==null?void 0:n.percentage)>0&&e.jsxs("div",{children:[e.jsxs("b",{className:"text-danger",children:["-",ee(n==null?void 0:n.percentage)]})," ",e.jsx("span",{className:"text-neutral-400 line-through",children:w(n==null?void 0:n.base)})]}),e.jsxs("span",{className:"text-customSwitch",children:["Total ",w(n==null?void 0:n.total)]})]})]})}const ye=J(e.jsx("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"})),C={retiro:{label:"Voy a retirar",description_item:"Quiero pasar a retirar",description_select:"Debe coordinar cuando quiera pasar."},coordinar:{label:"Quiero coordinar",description_item:"Quiero saber cuando se hagan entregas en el centro",description_select:""},cadete:{label:"Mando a buscarlo",description_item:"Quiero enviar a que lo busquen",description_select:"Si es un Uber, se transfiere el pago antes de entregar."},envio:{label:"Env칤o",description_item:"Quiero que me lo env칤en",description_select:"Se transfiere el env칤o antes y se paga en la entrega."},envio_uber:{label:"Env칤o: Uber",description_item:"Quiero que me lo env칤en por Uber",description_select:"Se transfiere el pago + env칤o antes."},envio_online:{label:"Env칤o: Tienda Online",description_item:"Quiero intermediar con Mercado Libre",description_select:"Puede comprar y arreglar por medio de ML(se pagan comisiones)."},envio_encomienda:{label:"Env칤o: Encomienda",description_item:"Quiero arreglar un env칤o por correo",description_select:""}};function _e({downloading:o=!1,entrega:h={value:"retiro",label:"",following:!1},setEntrega:m}){var l;return e.jsxs("div",{id:"presupuesto",className:`flex flex-col gap-4 ${o?"w-fit p-4":""}`,children:[e.jsx(re,{id:"presupuesto_logo",className:"max-w-44 my-2"}),e.jsx("section",{className:"flex flex-col items-center gap-2",children:e.jsx(pe,{name:"shipping",size:"sm",label:"Entrega",className:"max-w-xs dark:text-white",classNames:{listbox:"dark:text-white",trigger:"border-2 border-customSwitch/80",popoverContent:"border-2 border-customSwitch/80",description:"text-neutral-400 !text-second"},selectedKeys:[h.value],onSelectionChange:g=>{var S;const d=g.currentKey||"retiro",i={...h};i.value=d,i.label=(S=C==null?void 0:C[d])==null?void 0:S.label,m(i)},description:(l=C==null?void 0:C[h.value])==null?void 0:l.description_select,children:Object.entries(C).map(([g,d])=>e.jsx(xe,{description:d==null?void 0:d.description_item,children:d==null?void 0:d.label},g))})}),e.jsx(Se,{downloading:o,following:h.following}),e.jsxs("section",{className:"flex flex-col items-center gap-2 text-neutral-400 text-center",children:[e.jsxs("div",{className:"w-full flex flex-wrap items-center justify-center gap-3",children:[e.jsx(ve,{className:"h-6 w-fit"}),e.jsx(ye,{className:"h-6 w-fit"}),e.jsx(ne,{className:"h-6 w-fit"}),e.jsx(ie,{className:"h-6 w-fit"}),e.jsx(ce,{className:"h-5 w-fit"})]}),e.jsx(oe,{className:"w-2/3 bg-neutral-500/50"}),e.jsx("p",{children:"Gracias por su compra."}),o&&e.jsx("p",{children:o})]})]})}function qe(){const o=K(),h=o.cart.value,[m,l]=x.useState(!1),[g,d]=x.useState({value:"retiro",label:"Voy a retirar",following:!1}),i=()=>{var k;const r=[`Hola. Me interesa hacer este pedido:
`];r.push(`*${g.label}
`),g.following&&r.push(`*Sigo las redes.
`);let f=0,n=X.sort((u,b)=>u.label.localeCompare(b.label)).filter(u=>u.id in h);n=JSON.parse(JSON.stringify(n)),n.forEach(u=>{const b=[],P=h[u.id]||0,E=T(u.priceData,g.following&&u.categorie[0]==="imanes",P),O=E.usePrice,$=E.prices[O]||0,z=$*P,Q=u==null?void 0:u.label;f+=z,b.push(u.id+" -"),b.push(Q+" =>"),b.push(w($)),b.push(`x${P}${E.salesUnit||"u"}`),b.push(`= ${w(z)}`);const V=b.join(" ");r.push(V)});const _=w(f);r.push(`Total ${_}`);const v=r.join(`
`),j=encodeURIComponent(v),M=`${(k=o.links)==null?void 0:k.whatsapp}&text=${j}`,I=window.open(M,"_blank","noopener,noreferrer");I&&I.focus()},S=()=>{const r=new Date,f=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),_=String(r.getDate()).padStart(2,"0"),v=String(r.getHours()).padStart(2,"0"),j=String(r.getMinutes()).padStart(2,"0");return`${f}/${n}/${_}-${v}:${j}`},q=[{label:"Limpiar",title:"Limpiar lista",icon:le,color:"primary",onPress:()=>o.cart.set({})},{label:"Descargar",title:"Descargar como imagen",icon:je,color:"secondary",onPress:async()=>{const r=document.querySelector("#presupuesto"),f=document.body.classList.contains("dark")?"black":"white";if(r){const n=S();l(!0);const _={backgroundColor:f,pixelRatio:2};setTimeout(async()=>{try{const v=await me(r,_),j=document.createElement("a");j.href=v,j.download=`presupuesto-imanes_tucuman-${n}.png`,j.click()}catch(v){console.error("Error al generar la imagen:",v)}l(!1)},200)}}},{label:"Continuar",title:"Continuar por WhatsApp",icon:de,color:"success",onPress:i}];return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"overflow-hidden max-xs:px-2 ",children:[e.jsx(_e,{downloading:m,entrega:g,setEntrega:d}),m&&e.jsx("span",{className:"bg-black/50 absolute inset-0 z-10 flex items-center justify-center",children:e.jsx(R,{size:"lg",color:"secondary"})})]}),e.jsx("section",{className:"flex gap-2 max-xs:px-2 flex-wrap justify-center",children:q.map((r,f)=>{var n;return e.jsx(ue,{title:r.title,arrow:!0,children:e.jsx("span",{children:e.jsx(B,{color:r.color,variant:"contained",disabled:((n=Object.keys(h))==null?void 0:n.length)<1||m,onClick:(r==null?void 0:r.onPress)||null,startIcon:e.jsx(r.icon,{className:"min-w-5 h-full"}),sx:{textTransform:"none",borderRadius:3,fontFamily:"unset",fontWeight:"bold"},children:r.label})})},f)})}),e.jsxs("section",{className:"text-center",children:[e.jsxs("p",{children:["Los pedidos de 500 o m치s unidades pueden conllevar una se침a y/o costo de env칤o y tiempo de espera.",e.jsx("br",{}),"Cuanto termine de revisar la lista envi칠 el pedido y ser치 redirigido a whatsapp para continuar."]}),e.jsxs("p",{className:"font-size-secondary text-neutral-400 sm:hidden",children:[e.jsx("br",{}),"Si esta usando un dispositivo m칩vil y quiere descargar el pedido en una imagen es recomendable estar conectado a una red wifi dado que la imagen generada tendr치 un peso considerable."]})]})]})}export{qe as default};
